(()=>{"use strict";var e,t;(t=e||(e={}))[t.onlyTop=1]="onlyTop",t[t.preferTop=2]="preferTop",t[t.desktop=3]="desktop";const o={active:[],deactive:[],login:[],logout:[],pay:[],orientation:[],network:[],swipe:[],token:[],permission:[],wallpaper:[],theme:[],language:[],safeArea:[],download:[],verify:[]};window.addEventListener("message",(e=>{const t=e.data.cmd;o[t]&&(o[t].forEach(((t,o)=>{if("function"==typeof t)if(t.__edger_uid__){const o=e.data.uid;t.__edger_uid__===o&&(t(e.data.payload,e.data.error),t.__edger_done__=!0)}else t(e.data.payload,e.data.error)})),o[t]=o[t].filter((e=>!0!==e.__edger_done__)))}));const n=(e,t)=>{const n=e;o[n]?o[n].push(t):o[n]=[t]},r=(t,o=e.preferTop)=>{o===e.preferTop?window.parent===window.parent.parent?(console.warn("No app shell, downgrade to desktop",t),window.parent.postMessage({...t},"*")):window.parent.parent.postMessage({...t},"*"):o===e.onlyTop?window.parent===window.parent.parent?console.warn("No app shell, ignore message",t):window.parent.parent.postMessage({...t},"*"):window.parent.postMessage({...t},"*")};let i=0;const s=(t,o,s={timeout:5e3,ignoreResponse:!0,deliverStrategy:e.preferTop,disableTimeout:!1},a="")=>{if(!t)throw new Error("Illegal cmd");const{timeout:p=1e3,ignoreResponse:d=!0,deliverStrategy:l,disableTimeout:c=!1}=s;return new Promise(((e,s)=>{if(d)r({cmd:t,payload:o,ts:Date.now()},l),e(void 0);else{const p=`${Math.random()}-${Date.now()}-${i++}`,d=function(t,o){o?(console.error("error",o),s({error:o})):e(t)};d.__edger_uid__=p,n(t,d),r({cmd:t,payload:o,uid:p,ts:Date.now(),scope:a},l)}}))},a=(t,n)=>{const r=o[t];r?(r.push(n),s("__edgeros_register_event__",{action:t},{deliverStrategy:e.desktop,ignoreResponse:!0})):console.warn(`The action you specified is unknown: ${t}`)},p={height:0,activeElement:{el:null,originToBottomHeight:0}},d=["outApp","logout","desktop","route"];let l=[],c=-1;function g(){l=[],c=-1}const u=(e,t)=>e.mark&&t.mark?JSON.stringify(e)===JSON.stringify(t):JSON.stringify({...e,mark:""})===JSON.stringify({...t,mark:""});let h=!0;const y={init:function(){window._routerInitialized||(window._routerInitialized=Symbol(),g(),d.forEach((e=>{const t={...history.state,mark:e};!function(e){let t=e.current;location.hash&&"#"===location.hash[0]&&(t="#"+t),history.pushState(e,"",t)}(t),l.push(t),c++})),function(){const e=e=>{const t=history[e];return function(o,n,r){t.call(history,o,n,r);const i=new Event(e);window.dispatchEvent(i)}};history.pushState=e("pushState"),history.replaceState=e("replaceState"),window.addEventListener("pushState",(()=>{h&&(l=l.slice(0,c+1),l.push(history.state),c++)})),window.addEventListener("replaceState",(()=>{h&&l.splice(c,1,history.state)})),window.addEventListener("popstate",(()=>{h&&function(){if("desktop"===history.state.mark)return c=2,void history.go(1);if("logout"===history.state.mark)return c=1,void history.go(2);if("outApp"===history.state.mark)return c=0,void history.go(3);let e=-1;for(let t=c-1;t>0&&-1===e;t--)u(l[t],history.state)&&(e=t);for(let t=c+1;t<l.length&&-1===e;t++)u(l[t],history.state)&&(e=t);c=e,-1===c&&history.go(1)}()}))}(),window.addEventListener("message",(e=>{const{cmd:t}=e.data;"active"===t?(h=!0,function(){const e=[...l],t=c;g();for(let t=0;t<e.length;t++)history.pushState(e[t],"",e[t].current);const o=t-e.length+1;o&&history.go(o)}()):"deactive"===t&&(h=!1)})))},direction:function(e){return history.state.current?.split("?")[0]===e?"forward":history.state.forward?.split("?")[0]===e?"backward":(history.state.back?.split("?")[0],"forward")},historyDepth:function(e){const t=l.findIndex((t=>t.current===e));return t<0?(console.warn("not find current route"),0):t>c?0:c-t},historyLength:function(){return c>3?c-3:0}},f=["top","left","right","bottom"],m={};let v,w,S;function T(){return w="CSS"in window&&"function"==typeof CSS.supports?CSS.supports("top: env(safe-area-inset-top)")?"env":CSS.supports("top: constant(safe-area-inset-top)")?"constant":"":"",w}function k(){if(w="string"==typeof w?w:T(),!w)return void f.forEach((e=>{m[e]=0}));function e(e,t){const o=e.style;Object.keys(t).forEach((e=>{const n=t[e];o[e]=n}))}const t=[];function o(e){e?t.push(e):t.forEach((e=>{e()}))}let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n={passive:!0}}});window.addEventListener("test",null,e)}catch(e){}S=document.createElement("div"),e(S,{position:"absolute",left:"0",top:"0",width:"0",height:"0",zIndex:"-1",overflow:"hidden",visibility:"hidden"}),f.forEach((t=>{!function(t,r){const i=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),p=document.createElement("div"),d={position:"absolute",width:"100px",height:"200px",boxSizing:"border-box",overflow:"hidden",paddingBottom:`${w}(safe-area-inset-${r})`};e(i,d),e(s,d),e(a,{transition:"0s",animation:"none",width:"400px",height:"400px"}),e(p,{transition:"0s",animation:"none",width:"250%",height:"250%"}),i.appendChild(a),s.appendChild(p),t.appendChild(i),t.appendChild(s),o((()=>{i.scrollTop=s.scrollTop=1e4;let e=i.scrollTop,t=s.scrollTop;function o(){this.scrollTop!==(this===i?e:t)&&(i.scrollTop=s.scrollTop=1e4,e=i.scrollTop,t=s.scrollTop,function(e){b.length||setTimeout((()=>{const e={};b.forEach((t=>{e[t]=m[t]})),b.length=0,E.forEach((t=>{t(e)}))}),0),b.push(e)}(r))}i.addEventListener("scroll",o,n),s.addEventListener("scroll",o,n)}));const l=getComputedStyle(i);Object.defineProperty(m,r,{configurable:!0,get:()=>parseFloat(l.paddingBottom)})}(S,t)})),document.body.appendChild(S),o(),v=!0}function _(e){return v||k(),m[e]}const b=[],E=[],R={get support(){return 0!=("string"==typeof w?w:T()).length},get top(){return _("top")},get left(){return _("left")},get right(){return _("right")},get bottom(){return _("bottom")},onChange:function(e){T()&&(v||k(),"function"==typeof e&&E.push(e))},offChange:function(e){const t=E.indexOf(e);t>=0&&E.splice(t,1)}},A=["top","left","right","bottom"];let C=!1;const x=()=>(C||(()=>{const e={top:R.top,left:R.left,right:R.right,bottom:R.bottom};A.forEach((t=>document.body.style.setProperty(`--edger-safe-area-inset-${t}`,`${e[t]}px`)))})(),s("safeArea",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop}).then((({safeAreaInsets:e})=>(A.forEach((t=>document.body.style.setProperty(`--edger-safe-area-inset-${t}`,`${e[t]}px`))),C=!0,{safeAreaInsets:e}))).catch((()=>({safeAreaInsets:{top:R.top,left:R.left,right:R.right,bottom:R.bottom}})))),I=()=>{R.onChange((e=>{if(!C){const t=Object.keys(e);Array.isArray(t)&&t.length&&t.forEach((t=>{document.body.style.setProperty(`--edger-safe-area-inset-${t}`,`${e[t]}px`)}))}})),x()};document.body?I():window.addEventListener("load",(()=>{I()}));const L={open:(t,o)=>s("open",{target:t,letter:o},{deliverStrategy:e.desktop,ignoreResponse:!1,timeout:12e4}),appworld:t=>s("openAppInWorld",{target:{id:t}},{ignoreResponse:!1,timeout:12e4,deliverStrategy:e.desktop}),letter:()=>s("letter",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop}),browser:t=>s("openInBrowser",{url:t},{deliverStrategy:e.desktop,ignoreResponse:!1}),title:t=>(window.__title=t,s("title",{title:t},{deliverStrategy:e.desktop,ignoreResponse:!1,timeout:5e3}))},B={request:t=>s("reqPerms",t,{ignoreResponse:!1,timeout:12e4,deliverStrategy:e.desktop}),fetch:()=>s("permission",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop})},O={qrscan:()=>s("qrscan",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:3e5,disableTimeout:!0}),qrscanStop:()=>{s("qrscanStop",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4})},contacts:()=>s("contacts",{},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:5e4}),version:()=>s("version",{},{deliverStrategy:e.onlyTop,ignoreResponse:!1,timeout:5e3})},$={download:(t,o,n)=>s("downloadFile",{uri:t,options:o,headers:n},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4}).then((e=>{const{id:t,status:o}=e;return{id:t,status:o}})),abort:t=>s("downloadAbort",{id:t},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4}).then((e=>({success:e}))).catch((()=>({success:!1}))),state:t=>s("downloadState",{id:t},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4}).then((e=>(delete e.packageName,{...e}))),retry:t=>s("downloadFile",{id:t},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4}).then((e=>{const{id:t,status:o}=e;return{id:t,status:o}}))},N={open:t=>s("openFile",{id:t},{deliverStrategy:e.preferTop,ignoreResponse:!1,timeout:1e4}).then((e=>({success:e}))).catch((()=>({success:!1})))},P={state:()=>s("orientation",{},{deliverStrategy:e.preferTop,ignoreResponse:!1}),lock:t=>s("setOrientation",{type:"lock",orientation:t},{deliverStrategy:e.preferTop,ignoreResponse:!1}),unlock:()=>s("setOrientation",{type:"unlock"},{deliverStrategy:e.preferTop,ignoreResponse:!1})},H={pay:t=>s("payRequest",t,{deliverStrategy:e.desktop,ignoreResponse:!1,timeout:12e4})},q={safeArea:x},M={verify:()=>s("verifySecurity",null,{deliverStrategy:e.desktop,ignoreResponse:!1,timeout:12e4})},j={_on:n,_off:function(e){const t=e;return this.removeAllListeners(t)},_emit:r,_cmd:s,onAction:a,addEventListener:function(t,n){if("function"!=typeof n)throw new TypeError("listener must be a function");const r=o[t];return r&&(r.push(n),s("__edgeros_register_event__",{action:t},{deliverStrategy:e.desktop,ignoreResponse:!0})),this},removeEventListener:function(e,t){if("function"!=typeof t)throw new TypeError("listener must be a function");return o[e]&&(o[e]=o[e].filter((e=>e!==t))),this},removeAllListeners:function(e){return e?o[e]&&(o[e]=[]):Object.keys(o).forEach((e=>{o[e]&&(o[e]=[])})),this},user:()=>s("user",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop}),avoidKeyboardOverlay:(t="#app",o=".van-dialog")=>window.addEventListener("message",(n=>{if("keyboardHeight"===n.data.cmd){let i=0,s=document.querySelector(t);const a=document.documentElement.clientHeight||document.body.clientHeight,d=document.activeElement;let l=document.activeElement;const c=+n.data.payload.keyboardHeight,g=document.querySelectorAll(o),u=Array.from(g).filter((e=>"none"!==e.style.display))[0],h=u&&"none"!==u.style.display;if(h&&(s=u,l=u,i=l.getBoundingClientRect().top),s.style.transition||(s.style.transition="margin-top .3s ease-in-out"),c||(p.height=0,p.activeElement.el=null,p.activeElement.originToBottomHeight=0,s.style.marginTop="0px"),c>0&&d&&("INPUT"===d.tagName.toUpperCase()||"TEXTAREA"===d.tagName.toUpperCase())){let t=!1,o=a-l.getBoundingClientRect().bottom;if(p.height){const e=p.activeElement.originToBottomHeight;if(e){let n=0;try{n=parseFloat(getComputedStyle(s).marginTop.replace(/[px ]/g,""))}catch(e){console.error("计算keyboard marginTop出错",e)}let r=a-d.getBoundingClientRect().bottom+n,i=0,l=40;p.activeElement.el&&(l=10,i=a-p.activeElement.el.getBoundingClientRect().bottom+n-p.activeElement.originToBottomHeight),r-=i,t=Math.abs(r-e)>l,o=t?r:e}}if(!t&&c<=p.height&&p.height-c<150)return;if(t||o<c){p.activeElement.el=d,p.activeElement.originToBottomHeight=o,p.height=c;let t=o-c;i>0&&(t=i-Math.abs(t)>25?t:25-i),t>=0&&(t=0),s.style.marginTop=t+"px",h||r({cmd:"switchStatusBar",payload:"hide"},e.onlyTop)}}else s.style.marginTop="0px",g.length&&Array.from(g).forEach((e=>e.style.marginTop="0px")),r({cmd:"switchStatusBar",payload:"show"},e.onlyTop)}})),app:L,notify:(F={},z=t=>{t&&["info","warning","error","success"].forEach((o=>{t[o]=t=>{s("notify",{message:t,level:o},{deliverStrategy:e.desktop,ignoreResponse:!0})}}))},F?z(F):console.error("target object is null"),F),mobile:O,permission:B,payment:H,apps:(t,o=!1)=>s("apps",{appids:t,ico:o},{deliverStrategy:e.desktop,ignoreResponse:!1}),orientation:P,network:()=>s("network",{},{ignoreResponse:!1,deliverStrategy:e.preferTop}),language:()=>s("language",{},{deliverStrategy:e.desktop,ignoreResponse:!1}),version:()=>s("version",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop}),token:()=>s("token",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.desktop}),enableHistoryNavigation:()=>{window.sessionStorage.getItem("entryPath")||window.sessionStorage.setItem("entryPath",window.location.href),a("swipe",(function(e){"left"!==e.direction&&"right"!==e.direction||(window.sessionStorage.getItem("entryPath")!==window.location.href?window.history.back():r({cmd:"minEap"},3))}))},theme:()=>s("theme",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.preferTop}),env:()=>s("env",{},{ignoreResponse:!1,timeout:5e3,deliverStrategy:e.preferTop}).then((e=>{const t=e;return"mobile"===t.env&&(t.env="edgerapp"),t})),layout:q,downloadTask:$,filesystem:N,security:M,router:y};var F,z;((t=10)=>{setInterval((()=>{s("ping",{},{ignoreResponse:!0,timeout:5e3,deliverStrategy:e.desktop})}),1e3*t)})(30),s("__edgeros_register__",{},{deliverStrategy:e.desktop,ignoreResponse:!0}),s("__edgeros_register__",{},{deliverStrategy:e.onlyTop,ignoreResponse:!0}),window.edger=j})();